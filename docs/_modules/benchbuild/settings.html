
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>benchbuild.settings &#8212; benchbuild 1.3.2 documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.3.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">benchbuild 1.3.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for benchbuild.settings</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Settings module for benchbuild.</span>

<span class="sd">All settings are stored in a simple dictionary. Each</span>
<span class="sd">setting should be modifiable via environment variable.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">copy</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">plumbum</span> <span class="k">import</span> <span class="n">local</span>


<div class="viewcode-block" id="available_cpu_count"><a class="viewcode-back" href="../../benchbuild.html#benchbuild.settings.available_cpu_count">[docs]</a><span class="k">def</span> <span class="nf">available_cpu_count</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the number of available CPUs.</span>

<span class="sd">    Number of available virtual or physical CPUs on this system, i.e.</span>
<span class="sd">    user/real as output by time(1) when called with an optimally scaling</span>
<span class="sd">    userspace-only program.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Number of avaialable CPUs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;benchbuild&#39;</span><span class="p">)</span>

    <span class="c1"># cpuset</span>
    <span class="c1"># cpuset may restrict the number of *available* processors</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?m)^Cpus_allowed:\s*(.*)$&#39;</span><span class="p">,</span>
                          <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/proc/self/status&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="mi">16</span><span class="p">))</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">res</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">res</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Could not get the number of allowed CPUs&quot;</span><span class="p">)</span>

    <span class="c1"># http://code.google.com/p/psutil/</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">psutil</span>
        <span class="k">return</span> <span class="n">psutil</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>  <span class="c1"># psutil.NUM_CPUS on old versions</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Could not get the number of allowed CPUs&quot;</span><span class="p">)</span>

    <span class="c1"># POSIX</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sysconf</span><span class="p">(</span><span class="s1">&#39;SC_NPROCESSORS_ONLN&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">res</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">res</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Could not get the number of allowed CPUs&quot;</span><span class="p">)</span>

    <span class="c1"># Linux</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/proc/cpuinfo&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;processor</span><span class="se">\t</span><span class="s1">:&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">res</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">res</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Could not get the number of allowed CPUs&quot;</span><span class="p">)</span>

    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Can not determine number of CPUs on this system&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="InvalidConfigKey"><a class="viewcode-back" href="../../benchbuild.html#benchbuild.settings.InvalidConfigKey">[docs]</a><span class="k">class</span> <span class="nc">InvalidConfigKey</span><span class="p">(</span><span class="ne">RuntimeWarning</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Warn, if you access a non-existing key benchbuild&#39;s configuration.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="UUIDEncoder"><a class="viewcode-back" href="../../benchbuild.html#benchbuild.settings.UUIDEncoder">[docs]</a><span class="k">class</span> <span class="nc">UUIDEncoder</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Encoder module for UUID objects.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="UUIDEncoder.default"><a class="viewcode-back" href="../../benchbuild.html#benchbuild.settings.UUIDEncoder.default">[docs]</a>    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Encode UUID objects as string.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="escape_json"><a class="viewcode-back" href="../../benchbuild.html#benchbuild.settings.escape_json">[docs]</a><span class="k">def</span> <span class="nf">escape_json</span><span class="p">(</span><span class="n">raw_str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Shell-Escape a json input string.</span>

<span class="sd">    Args:</span>
<span class="sd">        raw_str: The unescaped string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">json_list</span> <span class="o">=</span> <span class="s1">&#39;[&#39;</span>
    <span class="n">json_set</span> <span class="o">=</span> <span class="s1">&#39;{&#39;</span>
    <span class="k">if</span> <span class="n">json_list</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">raw_str</span> <span class="ow">and</span> <span class="n">json_set</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">raw_str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">raw_str</span>

    <span class="n">str_quotes</span> <span class="o">=</span> <span class="s1">&#39;&quot;&#39;</span>
    <span class="n">i_str_quotes</span> <span class="o">=</span> <span class="s2">&quot;&#39;&quot;</span>
    <span class="k">if</span> <span class="n">str_quotes</span> <span class="ow">in</span> <span class="n">raw_str</span> <span class="ow">and</span> <span class="n">str_quotes</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">raw_str</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">raw_str</span>

    <span class="k">if</span> <span class="n">str_quotes</span> <span class="ow">in</span> <span class="n">raw_str</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">raw_str</span> <span class="o">=</span> <span class="n">i_str_quotes</span> <span class="o">+</span> <span class="n">raw_str</span> <span class="o">+</span> <span class="n">i_str_quotes</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">raw_str</span> <span class="o">=</span> <span class="n">str_quotes</span> <span class="o">+</span> <span class="n">raw_str</span> <span class="o">+</span> <span class="n">str_quotes</span>
    <span class="k">return</span> <span class="n">raw_str</span></div>


<div class="viewcode-block" id="Configuration"><a class="viewcode-back" href="../../benchbuild.html#benchbuild.settings.Configuration">[docs]</a><span class="k">class</span> <span class="nc">Configuration</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dictionary-like data structure to contain all configuration variables.</span>

<span class="sd">    This serves as a configuration dictionary throughout benchbuild. You can</span>
<span class="sd">    use it to access all configuration options that are available. Whenever the</span>
<span class="sd">    structure is updated with a new subtree, all variables defined in the new</span>
<span class="sd">    subtree are updated from the environment.</span>

<span class="sd">    Environment variables are generated from the tree paths automatically.</span>
<span class="sd">        CFG[&quot;build_dir&quot;] becomes BB_BUILD_DIR</span>
<span class="sd">        CFG[&quot;llvm&quot;][&quot;dir&quot;] becomes BB_LLVM_DIR</span>

<span class="sd">    The configuration can be stored/loaded as JSON.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; from benchbuild import settings as s</span>
<span class="sd">        &gt;&gt;&gt; c = s.Configuration(&#39;bb&#39;)</span>
<span class="sd">        &gt;&gt;&gt; c[&#39;test&#39;] = 42</span>
<span class="sd">        &gt;&gt;&gt; c[&#39;test&#39;]</span>
<span class="sd">        BB_TEST=42</span>
<span class="sd">        &gt;&gt;&gt; str(c[&#39;test&#39;])</span>
<span class="sd">        &#39;42&#39;</span>
<span class="sd">        &gt;&gt;&gt; type(c[&#39;test&#39;])</span>
<span class="sd">        &lt;class &#39;benchbuild.settings.Configuration&#39;&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_key</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_key</span> <span class="o">=</span> <span class="n">parent_key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="n">node</span> <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">init</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_from_env</span><span class="p">()</span>

<div class="viewcode-block" id="Configuration.filter_exports"><a class="viewcode-back" href="../../benchbuild.html#benchbuild.settings.Configuration.filter_exports">[docs]</a>    <span class="k">def</span> <span class="nf">filter_exports</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_default</span><span class="p">():</span>
            <span class="n">do_export</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="s2">&quot;export&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>
                <span class="n">do_export</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;export&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">do_export</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">selfcopy</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">selfcopy</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">():</span>
                    <span class="n">selfcopy</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">filter_exports</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span> <span class="o">=</span> <span class="n">selfcopy</span><span class="o">.</span><span class="vm">__dict__</span></div>

<div class="viewcode-block" id="Configuration.store"><a class="viewcode-back" href="../../benchbuild.html#benchbuild.settings.Configuration.store">[docs]</a>    <span class="k">def</span> <span class="nf">store</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Store the configuration dictionary to a file.&quot;&quot;&quot;</span>

        <span class="n">selfcopy</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">selfcopy</span><span class="o">.</span><span class="n">filter_exports</span><span class="p">()</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outf</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">selfcopy</span><span class="o">.</span><span class="n">node</span><span class="p">,</span> <span class="n">outf</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">UUIDEncoder</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="Configuration.load"><a class="viewcode-back" href="../../benchbuild.html#benchbuild.settings.Configuration.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_from</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load the configuration dictionary from file.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">load_rec</span><span class="p">(</span><span class="n">inode</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Recursive part of loading.&quot;&quot;&quot;</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> \
                   <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">inode</span><span class="p">:</span>
                        <span class="n">load_rec</span><span class="p">(</span><span class="n">inode</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">config</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;benchbuild&#39;</span><span class="p">)</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                            <span class="s2">&quot;+ config element: &#39;</span><span class="si">{cfg}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cfg</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">inode</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">_from</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">_from</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">inf</span><span class="p">:</span>
                <span class="n">load_rec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">inf</span><span class="p">))</span>
                <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;config_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">_from</span><span class="p">)</span></div>

<div class="viewcode-block" id="Configuration.has_value"><a class="viewcode-back" href="../../benchbuild.html#benchbuild.settings.Configuration.has_value">[docs]</a>    <span class="k">def</span> <span class="nf">has_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check, if the node contains a &#39;value&#39;.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;value&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span></div>

<div class="viewcode-block" id="Configuration.has_default"><a class="viewcode-back" href="../../benchbuild.html#benchbuild.settings.Configuration.has_default">[docs]</a>    <span class="k">def</span> <span class="nf">has_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check, if the node contains a &#39;default&#39; value.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;default&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span></div>

<div class="viewcode-block" id="Configuration.is_leaf"><a class="viewcode-back" href="../../benchbuild.html#benchbuild.settings.Configuration.is_leaf">[docs]</a>    <span class="k">def</span> <span class="nf">is_leaf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check, if the node is a &#39;leaf&#39; node.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_value</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_default</span><span class="p">()</span></div>

<div class="viewcode-block" id="Configuration.init_from_env"><a class="viewcode-back" href="../../benchbuild.html#benchbuild.settings.Configuration.init_from_env">[docs]</a>    <span class="k">def</span> <span class="nf">init_from_env</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize this node from environment.</span>

<span class="sd">        If we&#39;re a leaf node, i.e., a node containing a dictionary that</span>
<span class="sd">        consist of a &#39;default&#39; key, compute our env variable and initialize</span>
<span class="sd">        our value from the environment.</span>
<span class="sd">        Otherwise, init our children.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="s1">&#39;default&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>
            <span class="n">env_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__to_env_var__</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_value</span><span class="p">():</span>
                <span class="n">env_val</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="n">env_var</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">env_val</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="n">env_var</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">])</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">env_val</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env_val</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">init_from_env</span><span class="p">()</span></div>

<div class="viewcode-block" id="Configuration.update"><a class="viewcode-back" href="../../benchbuild.html#benchbuild.settings.Configuration.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the configuration dictionary with new content.</span>

<span class="sd">        This just delegates the update down to the internal data structure.</span>
<span class="sd">        No validation is done on the format, be sure you know what you do.</span>

<span class="sd">        Args:</span>
<span class="sd">            cfg_dict: A configuration dictionary.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cfg_dict</span><span class="o">.</span><span class="n">node</span><span class="p">)</span></div>

<div class="viewcode-block" id="Configuration.value"><a class="viewcode-back" href="../../benchbuild.html#benchbuild.settings.Configuration.value">[docs]</a>    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the node value, if we&#39;re a leaf node.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; from benchbuild import settings as s</span>
<span class="sd">            &gt;&gt;&gt; c = s.Configuration(&quot;test&quot;)</span>
<span class="sd">            &gt;&gt;&gt; c[&#39;x&#39;] = { &quot;y&quot; : { &quot;value&quot; : None }, &quot;z&quot; : { &quot;value&quot; : 2 }}</span>
<span class="sd">            &gt;&gt;&gt; c[&#39;x&#39;][&#39;y&#39;].value() == None</span>
<span class="sd">            True</span>
<span class="sd">            &gt;&gt;&gt; c[&#39;x&#39;][&#39;z&#39;].value()</span>
<span class="sd">            2</span>
<span class="sd">            &gt;&gt;&gt; c[&#39;x&#39;].value()</span>
<span class="sd">            TEST_X_Y=null</span>
<span class="sd">            TEST_X_Z=2</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;value&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span></div>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Access to non-existing config element: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
                <span class="n">category</span><span class="o">=</span><span class="n">InvalidConfigKey</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Configuration</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Configuration</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">val</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;value&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Tried to get the str() value of an inner node.&quot;</span><span class="p">,</span>
                          <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_repr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_value</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__to_env_var__</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">+</span> <span class="n">escape_json</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_default</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__to_env_var__</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">+</span> <span class="n">escape_json</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]))</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>
            <span class="n">_repr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">_repr</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__to_env_var__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">parent_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_key</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">__to_env_var__</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">parent_key</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">parent_key</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span></div>


<div class="viewcode-block" id="to_env_dict"><a class="viewcode-back" href="../../benchbuild.html#benchbuild.settings.to_env_dict">[docs]</a><span class="k">def</span> <span class="nf">to_env_dict</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert configuration object to a flat dictionary.&quot;&quot;&quot;</span>
    <span class="n">entries</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">has_value</span><span class="p">():</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">config</span><span class="o">.</span><span class="n">__to_env_var__</span><span class="p">():</span> <span class="n">config</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]}</span>
    <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">has_default</span><span class="p">():</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">config</span><span class="o">.</span><span class="n">__to_env_var__</span><span class="p">():</span> <span class="n">config</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]}</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>
        <span class="n">entries</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">to_env_dict</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">entries</span></div>


<span class="c1"># Initialize the global configuration once.</span>
<span class="n">CFG</span> <span class="o">=</span> <span class="n">Configuration</span><span class="p">(</span>
    <span class="s2">&quot;bb&quot;</span><span class="p">,</span>
    <span class="n">node</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Version Number&quot;</span><span class="p">,</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;1.3.2-$Id: 27c6304d5b863f8699b24a4a32796a98138cdeb5 $&quot;</span><span class="p">,</span>
            <span class="s2">&quot;export&quot;</span><span class="p">:</span> <span class="kc">False</span>
        <span class="p">},</span>
        <span class="s2">&quot;verbosity&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;The verbosity level of the logger. Range: 0-4&quot;</span><span class="p">,</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">},</span>
        <span class="s2">&quot;config_file&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Config file path of benchbuild. Not guaranteed to exist.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;src_dir&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span>
            <span class="s2">&quot;source directory of benchbuild. Usually the git repo root dir.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="p">},</span>
        <span class="s2">&quot;build_dir&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span>
            <span class="s2">&quot;build directory of benchbuild. All intermediate projects will &quot;</span>
            <span class="s2">&quot;be placed here&quot;</span><span class="p">,</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s2">&quot;results&quot;</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="s2">&quot;test_dir&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span>
            <span class="s2">&quot;Additional test inputs, required for (some) run-time tests.&quot;</span>
            <span class="s2">&quot;These can be obtained from the a different repo. Most &quot;</span>
            <span class="s2">&quot;projects don&#39;t need it&quot;</span><span class="p">,</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s2">&quot;testinputs&quot;</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="s2">&quot;tmp_dir&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Temporary dir. This will be used for caching downloads.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s2">&quot;tmp&quot;</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Additional PATH variable for benchbuild.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
        <span class="p">},</span>
        <span class="s2">&quot;ld_library_path&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Additional library path for benchbuild.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
        <span class="p">},</span>
        <span class="s2">&quot;jobs&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span>
            <span class="s2">&quot;Number of jobs that can be used for building and running.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">available_cpu_count</span><span class="p">())</span>
        <span class="p">},</span>
        <span class="s2">&quot;experiment_id&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span>
            <span class="s2">&quot;The experiment UUID we run everything under.&quot;</span>
            <span class="s2">&quot;This groups the project runs in the database.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()),</span>
            <span class="s2">&quot;export&quot;</span><span class="p">:</span> <span class="kc">False</span>
        <span class="p">},</span>
        <span class="s2">&quot;experiment&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;The experiment name we run everything under.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;empty&quot;</span><span class="p">,</span>
            <span class="s2">&quot;export&quot;</span><span class="p">:</span> <span class="kc">False</span>
        <span class="p">},</span>
        <span class="s2">&quot;clean&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Clean temporary objects, after completion.&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;experiment_description&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()),</span>
            <span class="s2">&quot;export&quot;</span><span class="p">:</span> <span class="kc">False</span>
        <span class="p">},</span>
        <span class="s2">&quot;regression_prefix&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;tmp&quot;</span><span class="p">,</span> <span class="s2">&quot;benchbuild-regressions&quot;</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="s2">&quot;benchbuild_prefix&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="p">},</span>
        <span class="s2">&quot;benchbuild_ebuild&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
        <span class="p">},</span>
        <span class="s2">&quot;cleanup_paths&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span>
            <span class="s2">&quot;List of existing paths that benchbuild should delete in addition &quot;</span>
            <span class="s2">&quot;to the default cleanup steps.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;export&quot;</span><span class="p">:</span> <span class="kc">False</span>
        <span class="p">},</span>
        <span class="s2">&quot;use_database&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;LEGACY: Store results from libpprof in the database.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="mi">1</span>
        <span class="p">},</span>
        <span class="s2">&quot;sequence&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;The name of the sequence that should be used for &quot;</span> <span class="o">+</span> \
                    <span class="s2">&quot;preoptimization.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;no_preperation&quot;</span>
        <span class="p">}</span>
    <span class="p">})</span>

<span class="n">CFG</span><span class="p">[</span><span class="s2">&quot;unionfs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;enable&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Wrap all project operations in a unionfs filesystem.&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;base_dir&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s1">&#39;./base&#39;</span><span class="p">,</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s1">&#39;Path of the unpacked container.&#39;</span>
    <span class="p">},</span>
    <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s1">&#39;./image&#39;</span><span class="p">,</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s1">&#39;Name of the image directory&#39;</span>
    <span class="p">},</span>
    <span class="s2">&quot;image_prefix&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Prefix for the unionfs image directory.&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">CFG</span><span class="p">[</span><span class="s2">&quot;env&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;compiler_ld_library_path&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span>
        <span class="s2">&quot;List of paths to be added to the LD_LIBRARY_PATH variable of all &quot;</span>
        <span class="s2">&quot;compiler invocations.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">[]</span>
    <span class="p">},</span>
    <span class="s2">&quot;compiler_path&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span>
        <span class="s2">&quot;List of paths to be added to all PATH variable of all compiler &quot;</span>
        <span class="s2">&quot;invocations.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">[]</span>
    <span class="p">},</span>
    <span class="s2">&quot;binary_ld_library_path&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span>
        <span class="s2">&quot;List of paths to be added to the LD_LIBRARY_PATH variable of all &quot;</span>
        <span class="s2">&quot;binary invocations.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">[]</span>
    <span class="p">},</span>
    <span class="s2">&quot;binary_path&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span>
        <span class="s2">&quot;List of paths to be added to the PATH variable of all binary&quot;</span>
        <span class="s2">&quot;invocations.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">[]</span>
    <span class="p">},</span>
    <span class="s2">&quot;lookup_path&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Search path for plumbum imports&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">[]</span>
    <span class="p">},</span>
    <span class="s2">&quot;lookup_ld_library_path&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;LD_LIBRARY_PATH for plumbum imports&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">[]</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">CFG</span><span class="p">[</span><span class="s2">&quot;llvm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;dir&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Path to LLVM. This will be required.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s2">&quot;install&quot;</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="s2">&quot;src&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s2">&quot;benchbuild-llvm&quot;</span><span class="p">)</span>
    <span class="p">},</span>
<span class="p">}</span>

<span class="n">CFG</span><span class="p">[</span><span class="s1">&#39;db&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;host name of our db.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;localhost&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;port to connect to the database&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="mi">5432</span>
    <span class="p">},</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;The name of the PostgreSQL database that will be used.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;benchbuild&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span>
        <span class="s2">&quot;The name of the PostgreSQL user to connect to the database with.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;benchbuild&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;pass&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span>
        <span class="s2">&quot;The password for the PostgreSQL user used to connect to the database &quot;</span>
        <span class="s2">&quot;with.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;benchbuild&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;rollback&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Rollback all operations after benchbuild completes.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="kc">False</span>
    <span class="p">},</span>
    <span class="s2">&quot;dialect&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Which database backend should we use? &quot;</span>
                <span class="s2">&quot;Refer to sqlalchemy for available options.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;postgresql+psycopg2&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;create_functions&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Should we recreate our SQL functions from scratch?&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">CFG</span><span class="p">[</span><span class="s1">&#39;gentoo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;autotest_lang&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Language filter for ebuilds, like C or C++.&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;autotest_use&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span>
        <span class="s2">&quot;USE filter for ebuilds. Filters packages without the given use flags.&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;autotest_loc&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;/tmp/gentoo-autotest&quot;</span><span class="p">,</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Location for the list of auto generated ebuilds.&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;http_proxy&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;HTTP Proxy to use for downloads.&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;rsync_proxy&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;RSYNC Proxy to use for downloads.&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;ftp_proxy&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;FTP Proxy to use for downloads.&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">CFG</span><span class="p">[</span><span class="s2">&quot;slurm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;account&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;The SLURM account to use by default.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;cl&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;partition&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;The SLURM partition to use by default.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;chimaira&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;script&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span>
        <span class="s2">&quot;Name of the script that can be passed to SLURM. Used by external &quot;</span>
        <span class="s2">&quot;tools.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;slurm.sh&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;cpus_per_task&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span>
        <span class="s2">&quot;Number of CPUs that should be requested from SLURM. Used by external &quot;</span>
        <span class="s2">&quot;tools.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="mi">10</span>
    <span class="p">},</span>
    <span class="s2">&quot;node_dir&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span>
        <span class="s2">&quot;Node directory, when executing on a cluster node. This is not &quot;</span>
        <span class="s2">&quot;used by benchbuild directly, but by external scripts.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s2">&quot;results&quot;</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="s2">&quot;timelimit&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;The timelimit we want to give to a job&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;12:00:00&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;exclusive&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span>
        <span class="s2">&quot;Shall we reserve a node exclusively, or share it with others?&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">},</span>
    <span class="s2">&quot;multithread&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Hint SLURM to allow multithreading. (--hint=nomultithread)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="kc">False</span>
    <span class="p">},</span>
    <span class="s2">&quot;turbo&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Disable Intel Turbo Boost via SLURM. (--pstate-turbo=off)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="kc">False</span>
    <span class="p">},</span>
    <span class="s2">&quot;logs&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Location the SLURM logs will be stored&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;slurm.log&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;nice&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Add a niceness value on our priority&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="mi">0</span>
    <span class="p">},</span>
    <span class="s2">&quot;nice_clean&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Add a niceness value on our cleanup job priority&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="mi">2500</span>
    <span class="p">},</span>
    <span class="s2">&quot;max_running&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Limit the number of concurrent running array jobs&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="mi">0</span>
    <span class="p">},</span>
    <span class="s2">&quot;node_image&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Path to the archive we want on each cluster node.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">curdir</span><span class="p">,</span> <span class="s2">&quot;llvm.tar.gz&quot;</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="s2">&quot;extra_log&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Extra log file to be managed by SLURM&quot;</span><span class="p">,</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;/tmp/.slurm&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">CFG</span><span class="p">[</span><span class="s2">&quot;perf&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;A configuration for the pollyperformance experiment.&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">CFG</span><span class="p">[</span><span class="s2">&quot;cs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;components&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;List of filters for compilestats components.&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;names&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;List of filters for compilestats names.&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">CFG</span><span class="p">[</span><span class="s2">&quot;uchroot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;repo&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;https://github.com/PolyJIT/erlent.git/&quot;</span><span class="p">,</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;GIT Repo URL for erlent.&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">CFG</span><span class="p">[</span><span class="s2">&quot;plugins&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;autoload&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Should automatic load of plugins be enabled?&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;reports&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;benchbuild.reports.raw&quot;</span>
        <span class="p">],</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Report plugins.&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;experiments&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;benchbuild.experiments.raw&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.experiments.compilestats&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.experiments.polyjit&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.experiments.empty&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.experiments.papi&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.experiments.pjtest&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.experiments.compilestats_ewpt&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.experiments.pj_sequence&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.experiments.pollytest&quot;</span>
        <span class="p">],</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;The experiment plugins we know about.&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;projects&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;benchbuild.projects.gentoo&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.projects.lnt.lnt&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.projects.polybench.polybench&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.projects.benchbuild.bzip2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.projects.benchbuild.ccrypt&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.projects.benchbuild.crafty&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.projects.benchbuild.crocopat&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.projects.benchbuild.ffmpeg&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.projects.benchbuild.gzip&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.projects.benchbuild.js&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.projects.benchbuild.lammps&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.projects.benchbuild.lapack&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.projects.benchbuild.leveldb&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.projects.benchbuild.linpack&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.projects.benchbuild.lulesh&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.projects.benchbuild.luleshomp&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.projects.benchbuild.mcrypt&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.projects.benchbuild.minisat&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.projects.benchbuild.openssl&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.projects.benchbuild.postgres&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.projects.benchbuild.povray&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.projects.benchbuild.python&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.projects.benchbuild.rasdaman&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.projects.benchbuild.ruby&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.projects.benchbuild.sdcc&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.projects.benchbuild.sevenz&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.projects.benchbuild.sqlite3&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.projects.benchbuild.tcc&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.projects.benchbuild.x264&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.projects.benchbuild.xz&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.projects.apollo.scimark&quot;</span><span class="p">,</span>
            <span class="s2">&quot;benchbuild.projects.apollo.rodinia&quot;</span>
        <span class="p">],</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;The project plugins we know about.&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">CFG</span><span class="p">[</span><span class="s2">&quot;container&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;input&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;container.tar.bz2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Input container file/folder.&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;container-out.tar.bz2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Output container file.&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;mounts&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;List of paths that will be mounted inside the container.&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;prefixes&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;List of paths that will be treated as an &quot;</span>
                <span class="s2">&quot;existing prefix inside a container.&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;shell&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;/bin/bash&quot;</span><span class="p">,</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Command string that should be used as shell command.&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;known&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;List of known containers. Format: &quot;</span>
                <span class="s2">&quot;[{ &#39;path&#39;: &lt;path&gt;,&quot;</span>
                <span class="s2">&quot;   &#39;hash&#39;: &lt;hash&gt; }]&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;images&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;gentoo&quot;</span><span class="p">:</span> <span class="s2">&quot;gentoo.tar.bz2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ubuntu&quot;</span><span class="p">:</span> <span class="s2">&quot;ubuntu.tar.bz2&quot;</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">&quot;prefered&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;List of containers of which the project can chose from.&quot;</span>
                <span class="s2">&quot;Format:&quot;</span>
                <span class="s2">&quot;[{ &#39;path&#39;: &lt;path&gt; }]&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;strategy&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;polyjit&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;sync&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Update portage tree?&quot;</span><span class="p">},</span>
            <span class="s2">&quot;upgrade&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Upgrade all packages?&quot;</span><span class="p">},</span>
            <span class="s2">&quot;packages&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;sys-devel/gcc:5.4.0&quot;</span><span class="p">,</span> <span class="s2">&quot;env&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;ACCEPT_KEYWORDS&quot;</span><span class="p">:</span> <span class="s2">&quot;~amd64&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;USE&quot;</span><span class="p">:</span> <span class="s2">&quot;-filecaps&quot;</span>
                    <span class="p">}},</span>
                    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;dev-db/postgresql:9.5&quot;</span><span class="p">,</span> <span class="s2">&quot;env&quot;</span><span class="p">:</span> <span class="p">{}},</span>
                    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;dev-python/pip&quot;</span><span class="p">,</span> <span class="s2">&quot;env&quot;</span><span class="p">:</span> <span class="p">{}},</span>
                    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;net-misc/curl&quot;</span><span class="p">,</span> <span class="s2">&quot;env&quot;</span><span class="p">:</span> <span class="p">{}},</span>
                    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;sys-apps/likwid&quot;</span><span class="p">,</span> <span class="s2">&quot;env&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;USE&quot;</span><span class="p">:</span> <span class="s2">&quot;-filecaps&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;ACCEPT_KEYWORDS&quot;</span><span class="p">:</span> <span class="s2">&quot;~amd64&quot;</span>
                    <span class="p">}},</span>
                    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;dev-libs/libpfm&quot;</span><span class="p">,</span> <span class="s2">&quot;env&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;USE&quot;</span><span class="p">:</span> <span class="s2">&quot;static-libs&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;ACCEPT_KEYWORDS&quot;</span><span class="p">:</span> <span class="s2">&quot;~amd64&quot;</span>
                    <span class="p">}},</span>
                    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;sys-process/time&quot;</span><span class="p">,</span> <span class="s2">&quot;env&quot;</span><span class="p">:</span> <span class="p">{}},</span>
                    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;=dev-util/boost-build-1.58.0&quot;</span><span class="p">,</span> <span class="s2">&quot;env&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;ACCEPT_KEYWORDS&quot;</span><span class="p">:</span> <span class="s2">&quot;~amd64&quot;</span>
                    <span class="p">}},</span>
                    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;=dev-libs/boost-1.62-r1&quot;</span><span class="p">,</span> <span class="s2">&quot;env&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;ACCEPT_KEYWORDS&quot;</span><span class="p">:</span> <span class="s2">&quot;~amd64&quot;</span>
                    <span class="p">}},</span>
                    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;dev-libs/libpqxx&quot;</span><span class="p">,</span> <span class="s2">&quot;env&quot;</span><span class="p">:</span> <span class="p">{}},</span>
                    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;dev-lang/python-3.5.3&quot;</span><span class="p">,</span> <span class="s2">&quot;env&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;ACCEPT_KEYWORDS&quot;</span><span class="p">:</span> <span class="s2">&quot;~amd64&quot;</span>
                    <span class="p">}},</span>
                    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;dev-python/dill&quot;</span><span class="p">,</span> <span class="s2">&quot;env&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;ACCEPT_KEYWORDS&quot;</span><span class="p">:</span> <span class="s2">&quot;~amd64&quot;</span>
                    <span class="p">}}</span>
                <span class="p">],</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;A list of gentoo package atoms that should be merged.&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>


<div class="viewcode-block" id="find_config"><a class="viewcode-back" href="../../benchbuild.html#benchbuild.settings.find_config">[docs]</a><span class="k">def</span> <span class="nf">find_config</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;.benchbuild.json&#39;</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the path to the default config file.</span>

<span class="sd">    We look at :root: for the :default: config file. If we can&#39;t find it</span>
<span class="sd">    there we start looking at the parent directory recursively until we</span>
<span class="sd">    find a file named :default: and return the absolute path to it.</span>
<span class="sd">    If we can&#39;t find anything, we return None.</span>

<span class="sd">    Args:</span>
<span class="sd">        default: The name of the config file we look for.</span>
<span class="sd">        root: The directory to start looking for.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Path to the default config file, None if we can&#39;t find anything.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cur_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cur_path</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cur_path</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_root</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">pardir</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">find_config</span><span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="n">new_root</span><span class="p">)</span> <span class="k">if</span> <span class="n">new_root</span> <span class="o">!=</span> <span class="n">root</span> <span class="k">else</span> <span class="kc">None</span></div>


<span class="k">def</span> <span class="nf">__init_config</span><span class="p">(</span><span class="n">cfg</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This will initialize the given configuration object.</span>

<span class="sd">    The following resources are available in the same order:</span>
<span class="sd">        1) Default settings.</span>
<span class="sd">        2) Config file.</span>
<span class="sd">        3) Environment variables.</span>

<span class="sd">    WARNING: Environment variables do _not_ take precedence over the config</span>
<span class="sd">             file right now. (init_from_env will refuse to update the</span>
<span class="sd">             value, if there is already one.)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;BB_CONFIG_FILE&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">config_path</span><span class="p">:</span>
        <span class="n">config_path</span> <span class="o">=</span> <span class="n">find_config</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">config_path</span><span class="p">:</span>
        <span class="n">cfg</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">cfg</span><span class="p">[</span><span class="s2">&quot;config_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Configuration loaded from </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span>
            <span class="n">config_path</span><span class="p">)))</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">init_from_env</span><span class="p">()</span>


<div class="viewcode-block" id="update_env"><a class="viewcode-back" href="../../benchbuild.html#benchbuild.settings.update_env">[docs]</a><span class="k">def</span> <span class="nf">update_env</span><span class="p">():</span>
    <span class="n">lookup_path</span> <span class="o">=</span> <span class="n">CFG</span><span class="p">[</span><span class="s2">&quot;env&quot;</span><span class="p">][</span><span class="s2">&quot;lookup_path&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
    <span class="n">lookup_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">pathsep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lookup_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;PATH&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
        <span class="n">lookup_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">pathsep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">lookup_path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PATH&quot;</span><span class="p">]])</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PATH&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lookup_path</span>

    <span class="n">lib_path</span> <span class="o">=</span> <span class="n">CFG</span><span class="p">[</span><span class="s2">&quot;env&quot;</span><span class="p">][</span><span class="s2">&quot;lookup_ld_library_path&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
    <span class="n">lib_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">pathsep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lib_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;LD_LIBRARY_PATH&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
        <span class="n">lib_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">pathsep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">lib_path</span><span class="p">,</span>
                                        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;LD_LIBRARY_PATH&quot;</span><span class="p">]])</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;LD_LIBRARY_PATH&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lib_path</span>

    <span class="c1"># Update local&#39;s env property because we changed the environment</span>
    <span class="c1"># of the running python process.</span>
    <span class="n">local</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">PATH</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PATH&quot;</span><span class="p">])</span>
    <span class="n">local</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">LD_LIBRARY_PATH</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;LD_LIBRARY_PATH&quot;</span><span class="p">])</span></div>


<span class="n">__init_config</span><span class="p">(</span><span class="n">CFG</span><span class="p">)</span>
<span class="n">update_env</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">benchbuild 1.3.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Andreas Simbrger.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.2.
    </div>
  </body>
</html>