
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>plumbum.cli.switches &#8212; benchbuild 3.3.5.dev36+g9240d098.d20181019 documentation</title>
    <link rel="stylesheet" href="../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">benchbuild 3.3.5.dev36+g9240d098.d20181019 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for plumbum.cli.switches</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">plumbum.lib</span> <span class="k">import</span> <span class="n">six</span><span class="p">,</span> <span class="n">getdoc</span>
<span class="kn">from</span> <span class="nn">plumbum.cli.i18n</span> <span class="k">import</span> <span class="n">get_translation_for</span>
<span class="kn">from</span> <span class="nn">plumbum</span> <span class="k">import</span> <span class="n">local</span>

<span class="kn">from</span> <span class="nn">abc</span> <span class="k">import</span> <span class="n">abstractmethod</span>

<span class="n">_translation</span> <span class="o">=</span> <span class="n">get_translation_for</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">_</span><span class="p">,</span> <span class="n">ngettext</span> <span class="o">=</span> <span class="n">_translation</span><span class="o">.</span><span class="n">gettext</span><span class="p">,</span> <span class="n">_translation</span><span class="o">.</span><span class="n">ngettext</span>

<span class="k">class</span> <span class="nc">SwitchError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A general switch related-error (base class of all other switch errors)&quot;&quot;&quot;</span>
    <span class="k">pass</span>
<span class="k">class</span> <span class="nc">PositionalArgumentsError</span><span class="p">(</span><span class="n">SwitchError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Raised when an invalid number of positional arguments has been given&quot;&quot;&quot;</span>
    <span class="k">pass</span>
<span class="k">class</span> <span class="nc">SwitchCombinationError</span><span class="p">(</span><span class="n">SwitchError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Raised when an invalid combination of switches has been given&quot;&quot;&quot;</span>
    <span class="k">pass</span>
<span class="k">class</span> <span class="nc">UnknownSwitch</span><span class="p">(</span><span class="n">SwitchError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Raised when an unrecognized switch has been given&quot;&quot;&quot;</span>
    <span class="k">pass</span>
<span class="k">class</span> <span class="nc">MissingArgument</span><span class="p">(</span><span class="n">SwitchError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Raised when a switch requires an argument, but one was not provided&quot;&quot;&quot;</span>
    <span class="k">pass</span>
<span class="k">class</span> <span class="nc">MissingMandatorySwitch</span><span class="p">(</span><span class="n">SwitchError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Raised when a mandatory switch has not been given&quot;&quot;&quot;</span>
    <span class="k">pass</span>
<span class="k">class</span> <span class="nc">WrongArgumentType</span><span class="p">(</span><span class="n">SwitchError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Raised when a switch expected an argument of some type, but an argument of a wrong</span>
<span class="sd">    type has been given&quot;&quot;&quot;</span>
    <span class="k">pass</span>
<span class="k">class</span> <span class="nc">SubcommandError</span><span class="p">(</span><span class="n">SwitchError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Raised when there&#39;s something wrong with subcommands&quot;&quot;&quot;</span>
    <span class="k">pass</span>


<span class="c1">#===================================================================================================</span>
<span class="c1"># The switch decorator</span>
<span class="c1">#===================================================================================================</span>
<span class="k">class</span> <span class="nc">SwitchInfo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">switch</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">argtype</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">argname</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">mandatory</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">requires</span> <span class="o">=</span> <span class="p">(),</span>
        <span class="n">excludes</span> <span class="o">=</span> <span class="p">(),</span> <span class="n">help</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">overridable</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="s2">&quot;Switches&quot;</span><span class="p">,</span> <span class="n">envname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A decorator that exposes functions as command-line switches. Usage::</span>

<span class="sd">        class MyApp(Application):</span>
<span class="sd">            @switch([&quot;-l&quot;, &quot;--log-to-file&quot;], argtype = str)</span>
<span class="sd">            def log_to_file(self, filename):</span>
<span class="sd">                handler = logging.FileHandler(filename)</span>
<span class="sd">                logger.addHandler(handler)</span>

<span class="sd">            @switch([&quot;--verbose&quot;], excludes=[&quot;--terse&quot;], requires=[&quot;--log-to-file&quot;])</span>
<span class="sd">            def set_debug(self):</span>
<span class="sd">                logger.setLevel(logging.DEBUG)</span>

<span class="sd">            @switch([&quot;--terse&quot;], excludes=[&quot;--verbose&quot;], requires=[&quot;--log-to-file&quot;])</span>
<span class="sd">            def set_terse(self):</span>
<span class="sd">                logger.setLevel(logging.WARNING)</span>

<span class="sd">    :param names: The name(s) under which the function is reachable; it can be a string</span>
<span class="sd">                  or a list of string, but at least one name is required. There&#39;s no need</span>
<span class="sd">                  to prefix the name with ``-`` or ``--`` (this is added automatically),</span>
<span class="sd">                  but it can be used for clarity. Single-letter names are prefixed by ``-``,</span>
<span class="sd">                  while longer names are prefixed by ``--``</span>

<span class="sd">    :param envname:   Name of environment variable to extract value from, as alternative to argv</span>

<span class="sd">    :param argtype: If this function takes an argument, you need to specify its type. The</span>
<span class="sd">                    default is ``None``, which means the function takes no argument. The type</span>
<span class="sd">                    is more of a &quot;validator&quot; than a real type; it can be any callable object</span>
<span class="sd">                    that raises a ``TypeError`` if the argument is invalid, or returns an</span>
<span class="sd">                    appropriate value on success. If the user provides an invalid value,</span>
<span class="sd">                    :func:`plumbum.cli.WrongArgumentType`</span>

<span class="sd">    :param argname: The name of the argument; if ``None``, the name will be inferred from the</span>
<span class="sd">                    function&#39;s signature</span>

<span class="sd">    :param list: Whether or not this switch can be repeated (e.g. ``gcc -I/lib -I/usr/lib``).</span>
<span class="sd">                 If ``False``, only a single occurrence of the switch is allowed; if ``True``,</span>
<span class="sd">                 it may be repeated indefinitely. The occurrences are collected into a list,</span>
<span class="sd">                 so the function is only called once with the collections. For instance,</span>
<span class="sd">                 for ``gcc -I/lib -I/usr/lib``, the function will be called with</span>
<span class="sd">                 ``[&quot;/lib&quot;, &quot;/usr/lib&quot;]``.</span>

<span class="sd">    :param mandatory: Whether or not this switch is mandatory; if a mandatory switch is not</span>
<span class="sd">                      given, :class:`MissingMandatorySwitch &lt;plumbum.cli.MissingMandatorySwitch&gt;`</span>
<span class="sd">                      is raised. The default is ``False``.</span>

<span class="sd">    :param requires: A list of switches that this switch depends on (&quot;requires&quot;). This means that</span>
<span class="sd">                     it&#39;s invalid to invoke this switch without also invoking the required ones.</span>
<span class="sd">                     In the example above, it&#39;s illegal to pass ``--verbose`` or ``--terse``</span>
<span class="sd">                     without also passing ``--log-to-file``. By default, this list is empty,</span>
<span class="sd">                     which means the switch has no prerequisites. If an invalid combination</span>
<span class="sd">                     is given, :class:`SwitchCombinationError &lt;plumbum.cli.SwitchCombinationError&gt;`</span>
<span class="sd">                     is raised.</span>

<span class="sd">                     Note that this list is made of the switch *names*; if a switch has more</span>
<span class="sd">                     than a single name, any of its names will do.</span>

<span class="sd">                     .. note::</span>
<span class="sd">                        There is no guarantee on the (topological) order in which the actual</span>
<span class="sd">                        switch functions will be invoked, as the dependency graph might contain</span>
<span class="sd">                        cycles.</span>

<span class="sd">    :param excludes: A list of switches that this switch forbids (&quot;excludes&quot;). This means that</span>
<span class="sd">                     it&#39;s invalid to invoke this switch if any of the excluded ones are given.</span>
<span class="sd">                     In the example above, it&#39;s illegal to pass ``--verbose`` along with</span>
<span class="sd">                     ``--terse``, as it will result in a contradiction. By default, this list</span>
<span class="sd">                     is empty, which means the switch has no prerequisites. If an invalid</span>
<span class="sd">                     combination is given, :class:`SwitchCombinationError</span>
<span class="sd">                     &lt;plumbum.cli.SwitchCombinationError&gt;` is raised.</span>

<span class="sd">                     Note that this list is made of the switch *names*; if a switch has more</span>
<span class="sd">                     than a single name, any of its names will do.</span>

<span class="sd">    :param help: The help message (description) for this switch; this description is used when</span>
<span class="sd">                 ``--help`` is given. If ``None``, the function&#39;s docstring will be used.</span>

<span class="sd">    :param overridable: Whether or not the names of this switch are overridable by other switches.</span>
<span class="sd">                        If ``False`` (the default), having another switch function with the same</span>
<span class="sd">                        name(s) will cause an exception. If ``True``, this is silently ignored.</span>

<span class="sd">    :param group: The switch&#39;s *group*; this is a string that is used to group related switches</span>
<span class="sd">                  together when ``--help`` is given. The default group is ``Switches``.</span>

<span class="sd">    :returns: The decorated function (with a ``_switch_info`` attribute)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">names</span><span class="p">]</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span>
    <span class="n">requires</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">requires</span><span class="p">]</span>
    <span class="n">excludes</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">excludes</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">deco</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">argname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">argspec</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">getfullargspec</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="o">.</span><span class="n">args</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">argspec</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">argname2</span> <span class="o">=</span> <span class="n">argspec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">argname2</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;VALUE&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">argname2</span> <span class="o">=</span> <span class="n">argname</span>
        <span class="n">help2</span> <span class="o">=</span> <span class="n">getdoc</span><span class="p">(</span><span class="n">func</span><span class="p">)</span> <span class="k">if</span> <span class="n">help</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">help</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">help2</span><span class="p">:</span>
            <span class="n">help2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="n">func</span><span class="o">.</span><span class="n">_switch_info</span> <span class="o">=</span> <span class="n">SwitchInfo</span><span class="p">(</span><span class="n">names</span> <span class="o">=</span> <span class="n">names</span><span class="p">,</span> <span class="n">envname</span><span class="o">=</span><span class="n">envname</span><span class="p">,</span> <span class="n">argtype</span> <span class="o">=</span> <span class="n">argtype</span><span class="p">,</span> <span class="nb">list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">,</span> <span class="n">func</span> <span class="o">=</span> <span class="n">func</span><span class="p">,</span>
            <span class="n">mandatory</span> <span class="o">=</span> <span class="n">mandatory</span><span class="p">,</span> <span class="n">overridable</span> <span class="o">=</span> <span class="n">overridable</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="n">group</span><span class="p">,</span>
            <span class="n">requires</span> <span class="o">=</span> <span class="n">requires</span><span class="p">,</span> <span class="n">excludes</span> <span class="o">=</span> <span class="n">excludes</span><span class="p">,</span> <span class="n">argname</span> <span class="o">=</span> <span class="n">argname2</span><span class="p">,</span> <span class="n">help</span> <span class="o">=</span> <span class="n">help2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span>
    <span class="k">return</span> <span class="n">deco</span>

<span class="k">def</span> <span class="nf">autoswitch</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A decorator that exposes a function as a switch, &quot;inferring&quot; the name of the switch</span>
<span class="sd">    from the function&#39;s name (converting to lower-case, and replacing underscores with hyphens).</span>
<span class="sd">    The arguments are the same as for :func:`switch &lt;plumbum.cli.switch&gt;`.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">deco</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">switch</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">deco</span>

<span class="c1">#===================================================================================================</span>
<span class="c1"># Switch Attributes</span>
<span class="c1">#===================================================================================================</span>
<span class="k">class</span> <span class="nc">SwitchAttr</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A switch that stores its result in an attribute (descriptor). Usage::</span>

<span class="sd">        class MyApp(Application):</span>
<span class="sd">            logfile = SwitchAttr([&quot;-f&quot;, &quot;--log-file&quot;], str)</span>

<span class="sd">            def main(self):</span>
<span class="sd">                if self.logfile:</span>
<span class="sd">                    open(self.logfile, &quot;w&quot;)</span>

<span class="sd">    :param names: The switch names</span>
<span class="sd">    :param argtype: The switch argument&#39;s (and attribute&#39;s) type</span>
<span class="sd">    :param default: The attribute&#39;s default value (``None``)</span>
<span class="sd">    :param argname: The switch argument&#39;s name (default is ``&quot;VALUE&quot;``)</span>
<span class="sd">    :param kwargs: Any of the keyword arguments accepted by :func:`switch &lt;plumbum.cli.switch&gt;`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ATTR_NAME</span> <span class="o">=</span> <span class="s1">&#39;__plumbum_switchattr_dict__&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">argtype</span> <span class="o">=</span> <span class="nb">str</span><span class="p">,</span> <span class="n">default</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">argname</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;VALUE&quot;</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;Sets an attribute&quot;</span>  <span class="c1"># to prevent the help message from showing SwitchAttr&#39;s docstring</span>
        <span class="k">if</span> <span class="s2">&quot;help&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">default</span> <span class="ow">and</span> <span class="n">argtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;help&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;; the default is </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>

        <span class="n">switch</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">argtype</span> <span class="o">=</span> <span class="n">argtype</span><span class="p">,</span> <span class="n">argname</span> <span class="o">=</span> <span class="n">argname</span><span class="p">,</span> <span class="nb">list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">listtype</span> <span class="o">=</span> <span class="nb">type</span><span class="p">([])</span>
        <span class="k">if</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_default_value</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">listtype</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_default_value</span> <span class="o">=</span> <span class="n">listtype</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_default_value</span> <span class="o">=</span> <span class="p">[</span><span class="n">default</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_default_value</span> <span class="o">=</span> <span class="n">default</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inst</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__set__</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inst</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">inst</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ATTR_NAME</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inst</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">inst</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;cannot set an unbound SwitchAttr&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ATTR_NAME</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ATTR_NAME</span><span class="p">,</span> <span class="p">{</span><span class="bp">self</span> <span class="p">:</span> <span class="n">val</span><span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ATTR_NAME</span><span class="p">)[</span><span class="bp">self</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

<span class="k">class</span> <span class="nc">Flag</span><span class="p">(</span><span class="n">SwitchAttr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A specialized :class:`SwitchAttr &lt;plumbum.cli.SwitchAttr&gt;` for boolean flags. If the flag is not</span>
<span class="sd">    given, the value of this attribute is the ``default``; if it is given, the value changes</span>
<span class="sd">    to ``not default``. Usage::</span>

<span class="sd">        class MyApp(Application):</span>
<span class="sd">            verbose = Flag([&quot;-v&quot;, &quot;--verbose&quot;], help = &quot;If given, I&#39;ll be very talkative&quot;)</span>

<span class="sd">    :param names: The switch names</span>
<span class="sd">    :param default: The attribute&#39;s initial value (``False`` by default)</span>
<span class="sd">    :param kwargs: Any of the keyword arguments accepted by :func:`switch &lt;plumbum.cli.switch&gt;`,</span>
<span class="sd">                   except for ``list`` and ``argtype``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">default</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">SwitchAttr</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">argtype</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">default</span> <span class="o">=</span> <span class="n">default</span><span class="p">,</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inst</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__set__</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_value</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">CountOf</span><span class="p">(</span><span class="n">SwitchAttr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A specialized :class:`SwitchAttr &lt;plumbum.cli.SwitchAttr&gt;` that counts the number of</span>
<span class="sd">    occurrences of the switch in the command line. Usage::</span>

<span class="sd">        class MyApp(Application):</span>
<span class="sd">            verbosity = CountOf([&quot;-v&quot;, &quot;--verbose&quot;], help = &quot;The more, the merrier&quot;)</span>

<span class="sd">    If ``-v -v -vv`` is given in the command-line, it will result in ``verbosity = 4``.</span>

<span class="sd">    :param names: The switch names</span>
<span class="sd">    :param default: The default value (0)</span>
<span class="sd">    :param kwargs: Any of the keyword arguments accepted by :func:`switch &lt;plumbum.cli.switch&gt;`,</span>
<span class="sd">                   except for ``list`` and ``argtype``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">default</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">SwitchAttr</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">argtype</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">default</span> <span class="o">=</span> <span class="n">default</span><span class="p">,</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_value</span> <span class="o">=</span> <span class="n">default</span>  <span class="c1"># issue #118</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inst</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__set__</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>

<span class="c1">#===================================================================================================</span>
<span class="c1"># Decorator for function that adds argument checking</span>
<span class="c1">#===================================================================================================</span>



<span class="k">class</span> <span class="nc">positional</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs a validator on the main function for a class.</span>
<span class="sd">    This should be used like this::</span>

<span class="sd">        class MyApp(cli.Application):</span>
<span class="sd">            @cli.positional(cli.Range(1,10), cli.ExistingFile)</span>
<span class="sd">            def main(self, x, *f):</span>
<span class="sd">                # x is a range, f&#39;s are all ExistingFile&#39;s)</span>

<span class="sd">    Or, Python 3 only::</span>

<span class="sd">        class MyApp(cli.Application):</span>
<span class="sd">            def main(self, x : cli.Range(1,10), *f : cli.ExistingFile):</span>
<span class="sd">                # x is a range, f&#39;s are all ExistingFile&#39;s)</span>


<span class="sd">    If you do not want to validate on the annotations, use this decorator (</span>
<span class="sd">    even if empty) to override annotation validation.</span>

<span class="sd">    Validators should be callable, and should have a ``.choices()`` function with</span>
<span class="sd">    possible choices. (For future argument completion, for example)</span>

<span class="sd">    Default arguments do not go through the validator.</span>

<span class="sd">    #TODO: Check with MyPy</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kargs</span> <span class="o">=</span> <span class="n">kargs</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">getfullargspec</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
        <span class="n">args_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

        <span class="n">positional</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">args_names</span><span class="p">)</span>
        <span class="n">varargs</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">positional</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">))):</span>
            <span class="n">positional</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args_names</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">):</span>
            <span class="n">varargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

         <span class="c1"># All args are positional, so convert kargs to positional</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="n">m</span><span class="o">.</span><span class="n">varargs</span><span class="p">:</span>
                <span class="n">varargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kargs</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">positional</span><span class="p">[</span><span class="n">args_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">item</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kargs</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>

        <span class="n">function</span><span class="o">.</span><span class="n">positional</span> <span class="o">=</span> <span class="n">positional</span>
        <span class="n">function</span><span class="o">.</span><span class="n">positional_varargs</span> <span class="o">=</span> <span class="n">varargs</span>
        <span class="k">return</span> <span class="n">function</span>

<span class="k">class</span> <span class="nc">Validator</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">ABC</span><span class="p">):</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="s2">&quot;Must be implemented for a Validator to work&quot;</span>

    <span class="k">def</span> <span class="nf">choices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">partial</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Should return set of valid choices, can be given optional partial info&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;If not overridden, will print the slots as args&quot;&quot;&quot;</span>

        <span class="n">slots</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__mro__</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;__slots__&quot;</span><span class="p">,</span> <span class="p">()):</span>
                <span class="k">if</span> <span class="n">prop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;_&#39;</span><span class="p">:</span>
                    <span class="n">slots</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">)</span>
        <span class="n">mystrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> = </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">slots</span><span class="p">[</span><span class="n">name</span><span class="p">])</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">slots</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">(</span><span class="si">{1}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mystrs</span><span class="p">))</span>

<span class="c1">#===================================================================================================</span>
<span class="c1"># Switch type validators</span>
<span class="c1">#===================================================================================================</span>
<span class="k">class</span> <span class="nc">Range</span><span class="p">(</span><span class="n">Validator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A switch-type validator that checks for the inclusion of a value in a certain range.</span>
<span class="sd">    Usage::</span>

<span class="sd">        class MyApp(Application):</span>
<span class="sd">            age = SwitchAttr([&quot;--age&quot;], Range(18, 120))</span>

<span class="sd">    :param start: The minimal value</span>
<span class="sd">    :param end: The maximal value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">end</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;[</span><span class="si">{0:d}</span><span class="s2">..</span><span class="si">{1:d}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="ow">or</span> <span class="n">obj</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Not in range [</span><span class="si">{0:d}</span><span class="s2">..</span><span class="si">{1:d}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">obj</span>
    <span class="k">def</span> <span class="nf">choices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">partial</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="c1"># TODO: Add partial handling</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">Set</span><span class="p">(</span><span class="n">Validator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A switch-type validator that checks that the value is contained in a defined</span>
<span class="sd">    set of values. Usage::</span>

<span class="sd">        class MyApp(Application):</span>
<span class="sd">            mode = SwitchAttr([&quot;--mode&quot;], Set(&quot;TCP&quot;, &quot;UDP&quot;, case_sensitive = False))</span>

<span class="sd">    :param values: The set of values (strings)</span>
<span class="sd">    :param case_sensitive: A keyword argument that indicates whether to use case-sensitive</span>
<span class="sd">                             comparison or not. The default is ``False``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">values</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">case_sensitive</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;case_sensitive&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;got unexpected keyword argument(s): </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(((</span><span class="n">v</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_sensitive</span> <span class="k">else</span> <span class="n">v</span><span class="o">.</span><span class="n">lower</span><span class="p">()),</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;{{</span><span class="si">{0}</span><span class="s2">}}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_sensitive</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Expected one of </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">obj</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">choices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">partial</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="c1"># TODO: Add case sensitive/insensitive parital completion</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Predicate</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A wrapper for a single-argument function with pretty printing&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">func</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">choices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">partial</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>

<span class="nd">@Predicate</span>
<span class="k">def</span> <span class="nf">ExistingDirectory</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A switch-type validator that ensures that the given argument is an existing directory&quot;&quot;&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">local</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> is not a directory&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">p</span>


<span class="nd">@Predicate</span>
<span class="k">def</span> <span class="nf">MakeDirectory</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">local</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> is a file, should be nonexistent, or a directory&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">p</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">p</span>

<span class="nd">@Predicate</span>
<span class="k">def</span> <span class="nf">ExistingFile</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A switch-type validator that ensures that the given argument is an existing file&quot;&quot;&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">local</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> is not a file&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">p</span>

<span class="nd">@Predicate</span>
<span class="k">def</span> <span class="nf">NonexistentPath</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A switch-type validator that ensures that the given argument is a nonexistent path&quot;&quot;&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">local</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> already exists&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">p</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">benchbuild 3.3.5.dev36+g9240d098.d20181019 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Andreas Simbrger.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.1.
    </div>
  </body>
</html>