
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Extensions &#8212; benchbuild 3.3.5.dev36+g9240d098.d20181019 documentation</title>
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Dictionary-like configuration objects." href="benchbuild.utils.settings.html" />
    <link rel="prev" title="Projects" href="benchbuild.project.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="benchbuild.utils.settings.html" title="Dictionary-like configuration objects."
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="benchbuild.project.html" title="Projects"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">benchbuild 3.3.5.dev36+g9240d098.d20181019 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="extensions">
<span id="extensions"></span><h1>Extensions<a class="headerlink" href="#extensions" title="Permalink to this headline">¶</a></h1>
<p>Extensions are Benchbuild’s way to encode composable experiments.
In essence, an extension is just a callable (or Functor) with (optional) additional attributes.
Composability is achieved by storing an arbitrary number of child extensions that can be triggered at any point in the call method.
You can define your own extension by subclassing from <code class="docutils literal notranslate"><span class="pre">benchbuild.extensions.Extension</span></code>.
Your constructor should handle <code class="docutils literal notranslate"><span class="pre">*args</span></code> as child extensions and use <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> for additional
attributes required by the extension.
The <code class="docutils literal notranslate"><span class="pre">__call__</span></code> operator of your extension has to deal with arbitrary <code class="docutils literal notranslate"><span class="pre">*args</span></code> which are the binary and binary arguments for the experiment. Any additional dynamic parameters used by the extension can
be passed in via <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> again.</p>
<div class="section" id="wrap-a-binary-with-a-timeout-command">
<span id="wrap-a-binary-with-a-timeout-command"></span><h2>Wrap a binary with a timeout command<a class="headerlink" href="#wrap-a-binary-with-a-timeout-command" title="Permalink to this headline">¶</a></h2>
<p>As an example, let us wrap an arbitrary binary with a timeout command. For that we need
the <code class="docutils literal notranslate"><span class="pre">RunWithTimeout</span></code> extension as shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">RunWithTimeout</span><span class="p">(</span><span class="n">Extension</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">extensions</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="s2">&quot;10m&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RunWithTimeout</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">extensions</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">limit</span> <span class="o">=</span> <span class="n">limit</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">binary_command</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">benchbuild.utils.cmd</span> <span class="kn">import</span> <span class="n">timeout</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_next</span><span class="p">(</span>
            <span class="n">timeout</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">limit</span><span class="p">,</span> <span class="n">binary_command</span><span class="p">],</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<p>On initialization, we set the time limit to “10m” by default.
As soon as this extension is run, we get the binary_command as part of the <code class="docutils literal notranslate"><span class="pre">*args</span></code> and wrap
it with the command <code class="docutils literal notranslate"><span class="pre">timeout</span></code> with the given time limit.
The wrapped command then serves as the new <code class="docutils literal notranslate"><span class="pre">binary_command</span></code> for our child extensions.</p>
<p>Now, when you want to use this extension, you need to compose it with an extension that actually runs
the command afterwards. Benchbuild provides one that controls database tracking at the same time <code class="docutils literal notranslate"><span class="pre">benchbuild.extensions.RuntimeExtension</span></code>. You should use this one by default as at takes care of
tracking the binary call properly..</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">benchbuild.extensions</span> <span class="kn">as</span> <span class="nn">ext</span>

<span class="k">class</span> <span class="nc">RawTimeout</span><span class="p">(</span><span class="n">Experiment</span><span class="p">):</span>
    <span class="n">NAME</span> <span class="o">=</span> <span class="s1">&#39;raw-timeout&#39;</span>
    <span class="k">def</span> <span class="nf">actions_for_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">):</span>
        <span class="n">project</span><span class="o">.</span><span class="n">runtime_extension</span> <span class="o">=</span> <span class="n">ext</span><span class="o">.</span><span class="n">RunWithTimeout</span><span class="p">(</span>
            <span class="n">ext</span><span class="o">.</span><span class="n">RuntimeExtension</span><span class="p">(</span><span class="n">project</span><span class="p">),</span> <span class="n">timeout</span><span class="o">=</span><span class="s2">&quot;2m&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>If you compose many extensions, you can use the left shift operator to avoid cluttering your code with
a high nesting depth. Note, that you need to reverse the chaining order compared to the nested one, from outermost first to innermost first.
After composition, you have to assign the extension to the <code class="docutils literal notranslate"><span class="pre">runtime_extension</span></code> attribute of a <code class="docutils literal notranslate"><span class="pre">project</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">benchbuild.extensions</span> <span class="kn">as</span> <span class="nn">ext</span>

<span class="k">class</span> <span class="nc">RawTimeout</span><span class="p">(</span><span class="n">Experiment</span><span class="p">):</span>
    <span class="n">NAME</span> <span class="o">=</span> <span class="s1">&#39;raw-timeout&#39;</span>
    <span class="k">def</span> <span class="nf">actions_for_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">):</span>
        <span class="n">project</span><span class="o">.</span><span class="n">runtime_extension</span> <span class="o">=</span> \
               <span class="n">ext</span><span class="o">.</span><span class="n">RuntimeExtension</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> \
            <span class="o">&lt;&lt;</span> <span class="n">ext</span><span class="o">.</span><span class="n">RunWithTimeout</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="s2">&quot;2m&quot;</span><span class="p">)</span>

        <span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="module-benchbuild.extensions">
<span id="api-reference"></span><span id="api-reference"></span><h2>API reference<a class="headerlink" href="#module-benchbuild.extensions" title="Permalink to this headline">¶</a></h2>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Extensions</a><ul>
<li><a class="reference internal" href="#wrap-a-binary-with-a-timeout-command">Wrap a binary with a timeout command</a></li>
<li><a class="reference internal" href="#module-benchbuild.extensions">API reference</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="benchbuild.project.html"
                        title="previous chapter">Projects</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="benchbuild.utils.settings.html"
                        title="next chapter">Dictionary-like configuration objects.</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/benchbuild.extensions.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="benchbuild.utils.settings.html" title="Dictionary-like configuration objects."
             >next</a> |</li>
        <li class="right" >
          <a href="benchbuild.project.html" title="Projects"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">benchbuild 3.3.5.dev36+g9240d098.d20181019 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Andreas Simbürger.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.1.
    </div>
  </body>
</html>